<script>
  window.__emailSignature = <%- JSON.stringify(typeof site !== 'undefined' && site.emailSignature ? site.emailSignature : {}) %>;
  window.__companyLogo = '<%= typeof site !== "undefined" ? site.logo.src : "/images/msfg-logo.png" %>';
  window.__companyName = '<%= typeof site !== "undefined" ? site.companyName : "MSFG" %>';
</script>

<div class="calc-page">
  <div class="calc-page__header">
    <h1>Cover Letter</h1>
    <p>Generate a professional cover letter for loan presentations. Auto-fills from MISMO data in the workspace.</p>
  </div>

  <div class="calc-page__body">

    <!-- Section Toggles -->
    <div class="la-section-toggles">
      <span class="la-toggle-label">Sections:</span>
      <label class="la-toggle"><input type="checkbox" id="laTogBorrower" checked data-toggle="borrower"> Borrower</label>
      <label class="la-toggle"><input type="checkbox" id="laTogOldLoan" checked data-toggle="old-loan"> Current Loan</label>
      <label class="la-toggle"><input type="checkbox" id="laTogNewLoan" checked data-toggle="new-loan"> Proposed Loan</label>
      <label class="la-toggle"><input type="checkbox" id="laTogClosing" checked data-toggle="closing"> Closing Costs</label>
      <label class="la-toggle"><input type="checkbox" id="laTogSummary" checked data-toggle="summary"> Summary</label>
    </div>

    <!-- Greeting / Intro -->
    <div class="calc-section">
      <h2>Greeting / Intro</h2>
      <div class="form-group">
        <label for="laIntro">Customize the opening paragraph of your cover letter</label>
        <textarea id="laIntro" rows="3" style="width: 100%; resize: vertical;">Thank you for the opportunity to work with you on your home financing needs. Below is a summary of the loan options we discussed.</textarea>
      </div>
    </div>

    <!-- Borrower Information -->
    <div class="calc-section" data-section="borrower">
      <h2>Borrower Information</h2>
      <div class="form-grid">
        <div class="form-group">
          <label for="laBorrowerName">Borrower Name</label>
          <input type="text" id="laBorrowerName" placeholder="e.g. John Smith">
        </div>
        <div class="form-group">
          <label for="laCoBorrowerName">Co-Borrower Name</label>
          <input type="text" id="laCoBorrowerName" placeholder="(optional)">
        </div>
      </div>
      <div class="form-grid" style="margin-top: var(--space-md);">
        <div class="form-group">
          <label for="laStreet">Street Address</label>
          <input type="text" id="laStreet" placeholder="123 Main St">
        </div>
        <div class="form-group">
          <label for="laCity">City</label>
          <input type="text" id="laCity" placeholder="Denver">
        </div>
      </div>
      <div class="form-grid" style="margin-top: var(--space-md);">
        <div class="form-group">
          <label for="laState">State</label>
          <input type="text" id="laState" placeholder="CO">
        </div>
        <div class="form-group">
          <label for="laZip">Zip Code</label>
          <input type="text" id="laZip" placeholder="80202">
        </div>
      </div>
    </div>

    <!-- Current Loan -->
    <div class="calc-section" data-section="old-loan">
      <h2>Current Loan</h2>
      <div class="form-grid">
        <div class="form-group">
          <label for="laOldLender">Lender</label>
          <input type="text" id="laOldLender" placeholder="e.g. Wells Fargo">
        </div>
        <div class="form-group">
          <label for="laOldLoanType">Loan Type</label>
          <select id="laOldLoanType">
            <option value="Conventional">Conventional</option>
            <option value="FHA">FHA</option>
            <option value="VA">VA</option>
            <option value="USDA">USDA</option>
            <option value="Jumbo">Jumbo</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>
      <div class="form-grid" style="margin-top: var(--space-md);">
        <div class="form-group">
          <label for="laOldAmount">Loan Amount ($)</label>
          <input type="number" id="laOldAmount" step="1000" placeholder="0.00">
        </div>
        <div class="form-group">
          <label for="laOldRate">Interest Rate (%)</label>
          <input type="number" id="laOldRate" step="0.125" placeholder="0.000">
        </div>
        <div class="form-group">
          <label for="laOldTerm">Original Term (Years)</label>
          <select id="laOldTerm">
            <option value="10">10 Years</option>
            <option value="15">15 Years</option>
            <option value="20">20 Years</option>
            <option value="25">25 Years</option>
            <option value="30" selected>30 Years</option>
          </select>
        </div>
      </div>
      <div class="form-grid" style="margin-top: var(--space-md);">
        <div class="form-group">
          <label for="laOldPayment">Monthly P&I ($)
            <span class="help-icon" data-help="Leave blank to auto-calculate from loan amount, rate, and term.">?</span>
          </label>
          <input type="number" id="laOldPayment" step="0.01" placeholder="Auto-calculated">
        </div>
        <div class="form-group">
          <label for="laOldMI">Monthly MI ($)</label>
          <input type="number" id="laOldMI" step="0.01" placeholder="0.00">
        </div>
        <div class="form-group">
          <label for="laOldEscrow">Monthly Escrow ($)
            <span class="help-icon" data-help="Taxes + insurance escrowed monthly.">?</span>
          </label>
          <input type="number" id="laOldEscrow" step="0.01" placeholder="0.00">
        </div>
      </div>
    </div>

    <!-- Proposed Loan -->
    <div class="calc-section" data-section="new-loan">
      <h2>Proposed Loan</h2>
      <div class="form-grid">
        <div class="form-group">
          <label for="laNewLender">Lender</label>
          <input type="text" id="laNewLender" placeholder="e.g. Mountain States Financial Group">
        </div>
        <div class="form-group">
          <label for="laNewLoanType">Loan Type</label>
          <select id="laNewLoanType">
            <option value="Conventional">Conventional</option>
            <option value="FHA">FHA</option>
            <option value="VA">VA</option>
            <option value="USDA">USDA</option>
            <option value="Jumbo">Jumbo</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>
      <div class="form-grid" style="margin-top: var(--space-md);">
        <div class="form-group">
          <label for="laNewAmount">Loan Amount ($)</label>
          <input type="number" id="laNewAmount" step="1000" placeholder="0.00">
        </div>
        <div class="form-group">
          <label for="laNewRate">Interest Rate (%)</label>
          <input type="number" id="laNewRate" step="0.125" placeholder="0.000">
        </div>
        <div class="form-group">
          <label for="laNewTerm">Term (Years)</label>
          <select id="laNewTerm">
            <option value="10">10 Years</option>
            <option value="15">15 Years</option>
            <option value="20">20 Years</option>
            <option value="25">25 Years</option>
            <option value="30" selected>30 Years</option>
          </select>
        </div>
      </div>
      <div class="form-grid" style="margin-top: var(--space-md);">
        <div class="form-group">
          <label for="laNewPayment">Monthly P&I ($)
            <span class="help-icon" data-help="Leave blank to auto-calculate from loan amount, rate, and term.">?</span>
          </label>
          <input type="number" id="laNewPayment" step="0.01" placeholder="Auto-calculated">
        </div>
        <div class="form-group">
          <label for="laNewMI">Monthly MI ($)</label>
          <input type="number" id="laNewMI" step="0.01" placeholder="0.00">
        </div>
        <div class="form-group">
          <label for="laNewEscrow">Monthly Escrow ($)
            <span class="help-icon" data-help="Taxes + insurance escrowed monthly.">?</span>
          </label>
          <input type="number" id="laNewEscrow" step="0.01" placeholder="0.00">
        </div>
      </div>
    </div>

    <!-- Closing Costs -->
    <div class="calc-section" data-section="closing">
      <h2>Closing Costs</h2>
      <div class="form-grid">
        <div class="form-group">
          <label for="laClosingCosts">Estimated Closing Costs ($)</label>
          <input type="number" id="laClosingCosts" step="100" placeholder="0.00">
        </div>
        <div class="form-group">
          <label for="laCredits">Lender Credits ($)
            <span class="help-icon" data-help="Credits applied to reduce closing costs.">?</span>
          </label>
          <input type="number" id="laCredits" step="100" placeholder="0.00">
        </div>
      </div>
    </div>

    <!-- Summary -->
    <div class="calc-section" data-section="summary">
      <h2>Summary</h2>
      <div class="form-group">
        <label for="laSummary">Summary / Closing Notes
          <span class="help-icon" data-help="This text appears below the loan details in the generated cover letter.">?</span>
        </label>
        <textarea id="laSummary" rows="4" placeholder="Add any additional notes, conditions, or comments for the borrower..." style="width: 100%; resize: vertical;"></textarea>
      </div>
    </div>

    <!-- Hidden fields for MISMO LO data override -->
    <input type="hidden" id="laLoName">
    <input type="hidden" id="laLoNmls">
    <input type="hidden" id="laLoPhone">
    <input type="hidden" id="laLoEmail">
    <input type="hidden" id="laLoCompany">

    <!-- Action Bar -->
    <div class="action-bar" style="border-top: none;">
      <button class="btn btn-secondary" id="laResetBtn" type="button">Reset</button>
      <button class="btn btn-primary" id="laGenerateBtn" type="button">Generate Cover Letter</button>
    </div>

    <!-- Cover Letter Preview -->
    <div id="laResults" class="la-letter-preview" style="display: none;">
      <div class="la-letter" id="laLetterContent">
        <!-- Populated by generate() -->
      </div>
    </div>

  </div>
</div>
